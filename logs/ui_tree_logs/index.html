<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>UI Tree - UFO Documentation</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../../assets/_mkdocstrings.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "UI Tree";
        var mkdocs_page_input_path = "logs/ui_tree_logs.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> UFO Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../project_directory_structure/">Project Directory Structure</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Getting Started</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../getting_started/quick_start/">Quick Start</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../getting_started/more_guidance/">More Guidance</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Basic Modules</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../modules/session/">Session</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../modules/round/">Round</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../modules/context/">Context</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Configurations</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../configurations/user_configuration/">User Configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../configurations/developer_configuration/">Developer Configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../configurations/pricing_configuration/">Model Pricing</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Supported Models</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../supported_models/overview/">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../supported_models/openai/">OpenAI</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../supported_models/azure_openai/">Azure OpenAI</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../supported_models/gemini/">Gemini</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../supported_models/claude/">Claude</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../supported_models/qwen/">Qwen</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../supported_models/ollama/">Ollama</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../supported_models/custom_model/">Custom Model</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Agents</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../agents/overview/">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Agent Design</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../agents/design/memory/">Memory</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../agents/design/blackboard/">Blackboard</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../agents/design/state/">State</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../agents/design/prompter/">Prompter</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../agents/design/processor/">Processor</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../agents/host_agent/">HostAgent</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../agents/app_agent/">AppAgent</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../agents/follower_agent/">FollowerAgent</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../agents/evaluation_agent/">EvaluationAgent</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Prompts</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../prompts/overview/">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../prompts/basic_template/">Basic Prompts</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../prompts/examples_prompts/">Examples Prompts</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../prompts/api_prompts/">API Prompts</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Automator</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../automator/overview/">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../automator/ui_automator/">UI Automator</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../automator/wincom_automator/">API Automator</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../automator/web_automator/">Web Automator</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../automator/bash_automator/">Bash Automator</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../automator/ai_tool_automator/">AI Tool</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Logs</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../overview/">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../request_logs/">Request Logs</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../step_logs/">Step Logs</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../evaluation_logs/">Evaluation Logs</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../screenshots_logs/">Screenshots</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">UI Tree</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#fields-in-the-ui-tree-logs">Fields in the UI tree logs</a>
    </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Advanced Usage</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" >Reinforcing AppAgent</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../advanced_usage/reinforce_appagent/overview/">Overview</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../advanced_usage/reinforce_appagent/learning_from_help_document/">Learning from Help Document</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../advanced_usage/reinforce_appagent/learning_from_bing_search/">Learning from Bing Search</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../advanced_usage/reinforce_appagent/experience_learning/">Experience Learning</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../advanced_usage/reinforce_appagent/learning_from_demonstration/">Learning from User Demonstration</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../advanced_usage/follower_mode/">Follower Mode</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../advanced_usage/batch_mode/">Batch Mode</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Control Filtering</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../advanced_usage/control_filtering/overview/">Overview</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../advanced_usage/control_filtering/text_filtering/">Text Filtering</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../advanced_usage/control_filtering/semantic_filtering/">Semantic Filtering</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../advanced_usage/control_filtering/icon_filtering/">Icon Filtering</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../advanced_usage/customization/">Customization</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Creating Your AppAgent</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../creating_app_agent/overview/">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../creating_app_agent/help_document_provision/">Help Document Provision</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../creating_app_agent/demonstration_provision/">Demonstration Provision</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../creating_app_agent/warpping_app_native_api/">Warpping App-Native API</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Dataflow</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../dataflow/overview/">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../dataflow/instantiation/">Instantiation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../dataflow/execution/">Execution</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../dataflow/windows_app_env/">Windows App Environment</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../dataflow/result_schema/">Result Schema</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">About</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../about/CONTRIBUTING/">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../about/LICENSE/">License</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../about/CODE_OF_CONDUCT/">Code of Conduct</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../about/DISCLAIMER/">Disclaimer</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../about/SUPPORT/">Support</a>
                  </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../faq/">FAQ</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">UFO Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Logs</li>
      <li class="breadcrumb-item active">UI Tree</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="ui-tree-logs">UI Tree Logs</h1>
<p>UFO can save the entire UI tree of the application window at every step for data collection purposes. The UI tree can represent the application's UI structure, including the window, controls, and their properties. The UI tree logs are saved in the <code>logs/{task_name}/ui_tree</code> folder. You have to set the <code>SAVE_UI_TREE</code> flag to <code>True</code> in the <code>config_dev.yaml</code> file to enable the UI tree logs. Below is an example of the UI tree logs for application:</p>
<pre><code class="language-json">{
    &quot;id&quot;: &quot;node_0&quot;,
    &quot;name&quot;: &quot;Mail - Chaoyun Zhang - Outlook&quot;,
    &quot;control_type&quot;: &quot;Window&quot;,
    &quot;rectangle&quot;: {
        &quot;left&quot;: 628,
        &quot;top&quot;: 258,
        &quot;right&quot;: 3508,
        &quot;bottom&quot;: 1795
    },
    &quot;adjusted_rectangle&quot;: {
        &quot;left&quot;: 0,
        &quot;top&quot;: 0,
        &quot;right&quot;: 2880,
        &quot;bottom&quot;: 1537
    },
    &quot;relative_rectangle&quot;: {
        &quot;left&quot;: 0.0,
        &quot;top&quot;: 0.0,
        &quot;right&quot;: 1.0,
        &quot;bottom&quot;: 1.0
    },
    &quot;level&quot;: 0,
    &quot;children&quot;: [
        {
            &quot;id&quot;: &quot;node_1&quot;,
            &quot;name&quot;: &quot;&quot;,
            &quot;control_type&quot;: &quot;Pane&quot;,
            &quot;rectangle&quot;: {
                &quot;left&quot;: 3282,
                &quot;top&quot;: 258,
                &quot;right&quot;: 3498,
                &quot;bottom&quot;: 330
            },
            &quot;adjusted_rectangle&quot;: {
                &quot;left&quot;: 2654,
                &quot;top&quot;: 0,
                &quot;right&quot;: 2870,
                &quot;bottom&quot;: 72
            },
            &quot;relative_rectangle&quot;: {
                &quot;left&quot;: 0.9215277777777777,
                &quot;top&quot;: 0.0,
                &quot;right&quot;: 0.9965277777777778,
                &quot;bottom&quot;: 0.0468445022771633
            },
            &quot;level&quot;: 1,
            &quot;children&quot;: []
        }
    ]
}
</code></pre>
<h2 id="fields-in-the-ui-tree-logs">Fields in the UI tree logs</h2>
<p>Below is a table of the fields in the UI tree logs:</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>The unique identifier of the UI tree node.</td>
<td>String</td>
</tr>
<tr>
<td>name</td>
<td>The name of the UI tree node.</td>
<td>String</td>
</tr>
<tr>
<td>control_type</td>
<td>The type of the UI tree node.</td>
<td>String</td>
</tr>
<tr>
<td>rectangle</td>
<td>The absolute position of the UI tree node.</td>
<td>Dictionary</td>
</tr>
<tr>
<td>adjusted_rectangle</td>
<td>The adjusted position of the UI tree node.</td>
<td>Dictionary</td>
</tr>
<tr>
<td>relative_rectangle</td>
<td>The relative position of the UI tree node.</td>
<td>Dictionary</td>
</tr>
<tr>
<td>level</td>
<td>The level of the UI tree node.</td>
<td>Integer</td>
</tr>
<tr>
<td>children</td>
<td>The children of the UI tree node.</td>
<td>List of UI tree nodes</td>
</tr>
</tbody>
</table>
<h1 id="reference">Reference</h1>


<div class="doc doc-object doc-class">



<a id="automator.ui_control.ui_tree.UITree"></a>
    <div class="doc doc-contents first">


        <p>A class to represent the UI tree.</p>

        <p>Initialize the UI tree with the root element.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>root</code></b>
                  (<code><span title="pywinauto.controls.uiawrapper.UIAWrapper">UIAWrapper</span></code>)
              –
              <div class="doc-md-description">
                <p>The root element of the UI tree.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>





                  <details class="quote">
                    <summary>Source code in <code>automator/ui_control/ui_tree.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">:</span> <span class="n">UIAWrapper</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initialize the UI tree with the root element.</span>
<span class="sd">    :param root: The root element of the UI tree.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="n">root</span>

    <span class="c1"># The node counter to count the number of nodes in the UI tree.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">node_counter</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ui_tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_ui_tree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ui_tree</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()}</span>
</code></pre></div></td></tr></table></div>
                  </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h2 id="automator.ui_control.ui_tree.UITree.ui_tree" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ui_tree</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">

        <p>The UI tree.</p>
    </div>

</div>



<div class="doc doc-object doc-function">


<h2 id="automator.ui_control.ui_tree.UITree.apply_ui_tree_diff" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">apply_ui_tree_diff</span><span class="p">(</span><span class="n">ui_tree_1</span><span class="p">,</span> <span class="n">diff</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">

        <p>Apply a UI tree diff to ui_tree_1 to get ui_tree_2.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>ui_tree_1</code></b>
                  (<code><span title="typing.Dict">Dict</span>[str, <span title="typing.Any">Any</span>]</code>)
              –
              <div class="doc-md-description">
                <p>The original UI tree.</p>
              </div>
            </li>
            <li>
              <b><code>diff</code></b>
                  (<code><span title="typing.Dict">Dict</span>[str, <span title="typing.Any">Any</span>]</code>)
              –
              <div class="doc-md-description">
                <p>The diff to apply.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="typing.Dict">Dict</span>[str, <span title="typing.Any">Any</span>]</code>
              –
              <div class="doc-md-description">
                <p>The new UI tree after applying the diff.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>automator/ui_control/ui_tree.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">apply_ui_tree_diff</span><span class="p">(</span>
    <span class="n">ui_tree_1</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">diff</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Apply a UI tree diff to ui_tree_1 to get ui_tree_2.</span>
<span class="sd">    :param ui_tree_1: The original UI tree.</span>
<span class="sd">    :param diff: The diff to apply.</span>
<span class="sd">    :return: The new UI tree after applying the diff.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">ui_tree_2</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">ui_tree_1</span><span class="p">)</span>

    <span class="c1"># Build an ID map for quick node lookups</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">build_id_map</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">id_map</span><span class="p">):</span>
        <span class="n">id_map</span><span class="p">[</span><span class="n">node</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">node</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;children&quot;</span><span class="p">,</span> <span class="p">[]):</span>
            <span class="n">build_id_map</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">id_map</span><span class="p">)</span>

    <span class="n">id_map</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="s2">&quot;id&quot;</span> <span class="ow">in</span> <span class="n">ui_tree_2</span><span class="p">:</span>
        <span class="n">build_id_map</span><span class="p">(</span><span class="n">ui_tree_2</span><span class="p">,</span> <span class="n">id_map</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">remove_node_by_path</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="c1"># The path is a list of IDs from root to target node.</span>
        <span class="c1"># The target node is the last element. Its parent is the second to last element.</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># Removing the root</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">ui_tree_2</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="k">del</span> <span class="n">ui_tree_2</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">id_map</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="k">return</span>

        <span class="n">target_id</span> <span class="o">=</span> <span class="n">path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">parent_id</span> <span class="o">=</span> <span class="n">path</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">parent_node</span> <span class="o">=</span> <span class="n">id_map</span><span class="p">[</span><span class="n">parent_id</span><span class="p">]</span>
        <span class="c1"># Find and remove the child with target_id</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">parent_node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;children&quot;</span><span class="p">,</span> <span class="p">[])):</span>
            <span class="k">if</span> <span class="n">c</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">target_id</span><span class="p">:</span>
                <span class="n">parent_node</span><span class="p">[</span><span class="s2">&quot;children&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="k">break</span>

        <span class="c1"># Remove target_id from id_map</span>
        <span class="k">if</span> <span class="n">target_id</span> <span class="ow">in</span> <span class="n">id_map</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">id_map</span><span class="p">[</span><span class="n">target_id</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_node_by_path</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="c1"># Add the node at the specified path. The parent is path[-2], the node is path[-1].</span>
        <span class="c1"># The path[-1] should be node[&quot;id&quot;].</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># Replacing the root node entirely</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">ui_tree_2</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="k">del</span> <span class="n">ui_tree_2</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">ui_tree_2</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
            <span class="c1"># Rebuild id_map</span>
            <span class="n">id_map</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="k">if</span> <span class="s2">&quot;id&quot;</span> <span class="ow">in</span> <span class="n">ui_tree_2</span><span class="p">:</span>
                <span class="n">build_id_map</span><span class="p">(</span><span class="n">ui_tree_2</span><span class="p">,</span> <span class="n">id_map</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">target_id</span> <span class="o">=</span> <span class="n">path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">parent_id</span> <span class="o">=</span> <span class="n">path</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">parent_node</span> <span class="o">=</span> <span class="n">id_map</span><span class="p">[</span><span class="n">parent_id</span><span class="p">]</span>
        <span class="c1"># Ensure children list exists</span>
        <span class="k">if</span> <span class="s2">&quot;children&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">parent_node</span><span class="p">:</span>
            <span class="n">parent_node</span><span class="p">[</span><span class="s2">&quot;children&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Insert or append the node</span>
        <span class="c1"># We don&#39;t have a numeric index anymore, we just append, assuming order doesn&#39;t matter.</span>
        <span class="c1"># If order matters, we must store ordering info or do some heuristic.</span>
        <span class="n">parent_node</span><span class="p">[</span><span class="s2">&quot;children&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

        <span class="c1"># Update the id_map with the newly added subtree</span>
        <span class="n">build_id_map</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">id_map</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">modify_node_by_path</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">changes</span><span class="p">):</span>
        <span class="c1"># Modify fields of the node at the given ID</span>
        <span class="n">target_id</span> <span class="o">=</span> <span class="n">path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">node</span> <span class="o">=</span> <span class="n">id_map</span><span class="p">[</span><span class="n">target_id</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">field</span><span class="p">,</span> <span class="p">(</span><span class="n">old_val</span><span class="p">,</span> <span class="n">new_val</span><span class="p">)</span> <span class="ow">in</span> <span class="n">changes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">node</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_val</span>

    <span class="c1"># Apply removals first</span>
    <span class="c1"># Sort removals by length of path descending so we remove deeper nodes first.</span>
    <span class="c1"># This ensures we don&#39;t remove parents before children.</span>
    <span class="k">for</span> <span class="n">removal</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span>
        <span class="n">diff</span><span class="p">[</span><span class="s2">&quot;removed&quot;</span><span class="p">],</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">]),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">):</span>
        <span class="n">remove_node_by_path</span><span class="p">(</span><span class="n">removal</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">])</span>

    <span class="c1"># Apply additions</span>
    <span class="c1"># Additions can be applied directly.</span>
    <span class="k">for</span> <span class="n">addition</span> <span class="ow">in</span> <span class="n">diff</span><span class="p">[</span><span class="s2">&quot;added&quot;</span><span class="p">]:</span>
        <span class="n">add_node_by_path</span><span class="p">(</span><span class="n">addition</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">],</span> <span class="n">addition</span><span class="p">[</span><span class="s2">&quot;node&quot;</span><span class="p">])</span>

    <span class="c1"># Apply modifications</span>
    <span class="k">for</span> <span class="n">modification</span> <span class="ow">in</span> <span class="n">diff</span><span class="p">[</span><span class="s2">&quot;modified&quot;</span><span class="p">]:</span>
        <span class="n">modify_node_by_path</span><span class="p">(</span><span class="n">modification</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">],</span> <span class="n">modification</span><span class="p">[</span><span class="s2">&quot;changes&quot;</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">ui_tree_2</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="automator.ui_control.ui_tree.UITree.flatten_ui_tree" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">flatten_ui_tree</span><span class="p">()</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Flatten the UI tree into a list in width-first order.</p>

            <details class="quote">
              <summary>Source code in <code>automator/ui_control/ui_tree.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">flatten_ui_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Flatten the UI tree into a list in width-first order.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">flatten_tree</span><span class="p">(</span><span class="n">tree</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">result</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Flatten the tree.</span>
<span class="sd">        :param tree: The tree to flatten.</span>
<span class="sd">        :param result: The result list.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">tree_info</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">tree</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
            <span class="s2">&quot;control_type&quot;</span><span class="p">:</span> <span class="n">tree</span><span class="p">[</span><span class="s2">&quot;control_type&quot;</span><span class="p">],</span>
            <span class="s2">&quot;rectangle&quot;</span><span class="p">:</span> <span class="n">tree</span><span class="p">[</span><span class="s2">&quot;rectangle&quot;</span><span class="p">],</span>
            <span class="s2">&quot;adjusted_rectangle&quot;</span><span class="p">:</span> <span class="n">tree</span><span class="p">[</span><span class="s2">&quot;adjusted_rectangle&quot;</span><span class="p">],</span>
            <span class="s2">&quot;relative_rectangle&quot;</span><span class="p">:</span> <span class="n">tree</span><span class="p">[</span><span class="s2">&quot;relative_rectangle&quot;</span><span class="p">],</span>
            <span class="s2">&quot;level&quot;</span><span class="p">:</span> <span class="n">tree</span><span class="p">[</span><span class="s2">&quot;level&quot;</span><span class="p">],</span>
        <span class="p">}</span>

        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tree_info</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;children&quot;</span><span class="p">,</span> <span class="p">[]):</span>
            <span class="n">flatten_tree</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>

    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">flatten_tree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui_tree</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="automator.ui_control.ui_tree.UITree.save_ui_tree_to_json" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">save_ui_tree_to_json</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Save the UI tree to a JSON file.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>file_path</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>The file path to save the UI tree.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>automator/ui_control/ui_tree.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">save_ui_tree_to_json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Save the UI tree to a JSON file.</span>
<span class="sd">    :param file_path: The file path to save the UI tree.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Check if the file directory exists. If not, create it.</span>
    <span class="n">save_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">save_dir</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">save_dir</span><span class="p">)</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui_tree</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="automator.ui_control.ui_tree.UITree.ui_tree_diff" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ui_tree_diff</span><span class="p">(</span><span class="n">ui_tree_1</span><span class="p">,</span> <span class="n">ui_tree_2</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">

        <p>Compute the difference between two UI trees.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>ui_tree_1</code></b>
                  (<code><span title="typing.Dict">Dict</span>[str, <span title="typing.Any">Any</span>]</code>)
              –
              <div class="doc-md-description">
                <p>The first UI tree.</p>
              </div>
            </li>
            <li>
              <b><code>ui_tree_2</code></b>
                  (<code><span title="typing.Dict">Dict</span>[str, <span title="typing.Any">Any</span>]</code>)
              –
              <div class="doc-md-description">
                <p>The second UI tree.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              –
              <div class="doc-md-description">
                <p>The difference between the two UI trees.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>automator/ui_control/ui_tree.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">ui_tree_diff</span><span class="p">(</span><span class="n">ui_tree_1</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">ui_tree_2</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the difference between two UI trees.</span>
<span class="sd">    :param ui_tree_1: The first UI tree.</span>
<span class="sd">    :param ui_tree_2: The second UI tree.</span>
<span class="sd">    :return: The difference between the two UI trees.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">diff</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;added&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="s2">&quot;removed&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="s2">&quot;modified&quot;</span><span class="p">:</span> <span class="p">[]}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">compare_nodes</span><span class="p">(</span><span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="c1"># Note: `path` is a list of IDs. The last element corresponds to the current node.</span>
        <span class="c1"># If node1 doesn&#39;t exist and node2 does, it&#39;s an addition.</span>
        <span class="k">if</span> <span class="n">node1</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">node2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">diff</span><span class="p">[</span><span class="s2">&quot;added&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="n">path</span><span class="p">,</span> <span class="s2">&quot;node&quot;</span><span class="p">:</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">node2</span><span class="p">)})</span>
            <span class="k">return</span>

        <span class="c1"># If node1 exists and node2 doesn&#39;t, it&#39;s a removal.</span>
        <span class="k">if</span> <span class="n">node1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">node2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">diff</span><span class="p">[</span><span class="s2">&quot;removed&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="n">path</span><span class="p">,</span> <span class="s2">&quot;node&quot;</span><span class="p">:</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">node1</span><span class="p">)})</span>
            <span class="k">return</span>

        <span class="c1"># If both don&#39;t exist, nothing to do.</span>
        <span class="k">if</span> <span class="n">node1</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">node2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># Both nodes exist, check for modifications at this node</span>
        <span class="n">fields_to_compare</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;name&quot;</span><span class="p">,</span>
            <span class="s2">&quot;control_type&quot;</span><span class="p">,</span>
            <span class="s2">&quot;rectangle&quot;</span><span class="p">,</span>
            <span class="s2">&quot;adjusted_rectangle&quot;</span><span class="p">,</span>
            <span class="s2">&quot;relative_rectangle&quot;</span><span class="p">,</span>
            <span class="s2">&quot;level&quot;</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="n">changes</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">fields_to_compare</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">node1</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="o">!=</span> <span class="n">node2</span><span class="p">[</span><span class="n">field</span><span class="p">]:</span>
                <span class="n">changes</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">node1</span><span class="p">[</span><span class="n">field</span><span class="p">],</span> <span class="n">node2</span><span class="p">[</span><span class="n">field</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">changes</span><span class="p">:</span>
            <span class="n">diff</span><span class="p">[</span><span class="s2">&quot;modified&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="n">path</span><span class="p">,</span> <span class="s2">&quot;changes&quot;</span><span class="p">:</span> <span class="n">changes</span><span class="p">})</span>

        <span class="c1"># Compare children</span>
        <span class="n">children1</span> <span class="o">=</span> <span class="n">node1</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;children&quot;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="n">children2</span> <span class="o">=</span> <span class="n">node2</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;children&quot;</span><span class="p">,</span> <span class="p">[])</span>

        <span class="c1"># We&#39;ll assume children order is stable. If not, differences will appear as adds/removes.</span>
        <span class="n">max_len</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">children1</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">children2</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_len</span><span class="p">):</span>
            <span class="n">c1</span> <span class="o">=</span> <span class="n">children1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">children1</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="n">c2</span> <span class="o">=</span> <span class="n">children2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">children2</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="c1"># Use the child&#39;s id if available from c2 (prefer new tree), else from c1</span>
            <span class="k">if</span> <span class="n">c2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">child_id</span> <span class="o">=</span> <span class="n">c2</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">c1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">child_id</span> <span class="o">=</span> <span class="n">c1</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Both None shouldn&#39;t happen since max_len ensures one must exist</span>
                <span class="n">child_id</span> <span class="o">=</span> <span class="s2">&quot;unknown_child_id&quot;</span>

            <span class="n">compare_nodes</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">path</span> <span class="o">+</span> <span class="p">[</span><span class="n">child_id</span><span class="p">])</span>

    <span class="c1"># Initialize the path with the root node id if it exists</span>
    <span class="k">if</span> <span class="n">ui_tree_2</span> <span class="ow">and</span> <span class="s2">&quot;id&quot;</span> <span class="ow">in</span> <span class="n">ui_tree_2</span><span class="p">:</span>
        <span class="n">root_id</span> <span class="o">=</span> <span class="n">ui_tree_2</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">ui_tree_1</span> <span class="ow">and</span> <span class="s2">&quot;id&quot;</span> <span class="ow">in</span> <span class="n">ui_tree_1</span><span class="p">:</span>
        <span class="n">root_id</span> <span class="o">=</span> <span class="n">ui_tree_1</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># If no root id is present, assume a placeholder</span>
        <span class="n">root_id</span> <span class="o">=</span> <span class="s2">&quot;root&quot;</span>

    <span class="n">compare_nodes</span><span class="p">(</span><span class="n">ui_tree_1</span><span class="p">,</span> <span class="n">ui_tree_2</span><span class="p">,</span> <span class="p">[</span><span class="n">root_id</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">diff</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><p><br></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Save the UI tree logs may increase the latency of the system. It is recommended to set the <code>SAVE_UI_TREE</code> flag to <code>False</code> when you do not need the UI tree logs.</p>
</div>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../screenshots_logs/" class="btn btn-neutral float-left" title="Screenshots"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../../advanced_usage/reinforce_appagent/overview/" class="btn btn-neutral float-right" title="Overview">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../screenshots_logs/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../../advanced_usage/reinforce_appagent/overview/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
